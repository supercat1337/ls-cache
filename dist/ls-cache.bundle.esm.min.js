function o(l){let t=0;for(let e=0;e<l.length;e++)t=(t<<5)-t+l.charCodeAt(e)|0;return(t>>>0).toString(36)}var a=class{prefix="cache";#t;constructor(t="cache"){if(this.#t=n.window.localStorage,!this.#t)throw new Error("localStorage is undefined");this.prefix=t}getHash(t){return n.hash(t)}write(t,e,i){let s=this.getHash(t);this.setKey(s,e,i)}read(t){let e=this.getHash(t),i=this.readKey(e);return i===null?null:Math.ceil(Date.now()/1e3)>i.end?(this.removeKey(e),null):i.value}readKey(t){let e=this.#t.getItem(`${this.prefix}.${t}.start`),i=this.#t.getItem(`${this.prefix}.${t}.end`),s=this.#t.getItem(`${this.prefix}.${t}.value`);if(e===null||i===null||s===null)return null;let r=parseInt(e),h=parseInt(i);return isNaN(r)||isNaN(h)?(this.#t.removeItem(`${this.prefix}.${t}.start`),this.#t.removeItem(`${this.prefix}.${t}.end`),this.#t.removeItem(`${this.prefix}.${t}.value`),null):{start:r,end:h,value:s}}setKey(t,e,i){let s=Math.ceil(Date.now()/1e3),r=s+i;this.#t.setItem(`${this.prefix}.${t}.start`,s.toString()),this.#t.setItem(`${this.prefix}.${t}.end`,r.toString()),this.#t.setItem(`${this.prefix}.${t}.value`,e)}getKeys(){let t=new Set;for(let i=0;i<this.#t.length;i++){let s=this.#t.key(i);if(s&&s.startsWith(`${this.prefix}.`)){let r=s.replace(`${this.prefix}.`,"").split(".")[0];t.add(r)}}let e=[];return t.forEach(i=>{this.readKey(i)!==null&&e.push(i)}),e}removeAll(){for(let t=0;t<this.#t.length;t++){let e=this.#t.key(t);e&&e.startsWith(`${this.prefix}.`)&&this.#t.removeItem(e)}}removeKey(t){this.#t.removeItem(`${this.prefix}.${t}.start`),this.#t.removeItem(`${this.prefix}.${t}.end`),this.#t.removeItem(`${this.prefix}.${t}.value`)}removeOldKeys(t){let e=Math.ceil(t.getTime()/1e3);for(let i=0;i<this.#t.length;i++){let s=this.#t.key(i);if(s&&s.startsWith(`${this.prefix}.`)){let r=s.replace(`${this.prefix}.`,"").split(".")[0],h=this.readKey(r);h!==null&&h.start<e&&this.removeKey(r)}}}},n={window:globalThis,hash:o};export{a as CacheStorage,n as cacheStorageConfig};
